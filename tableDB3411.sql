DROP TABLE BUYTBL3411;
DROP TABLE CUSTTBL3411;
DROP TABLE PROTBL3411;

-- custTbl3411 생성
CREATE TABLE CUSTTBL3411 
(
  CUSTCODE CHAR(5) NOT NULL 
, ADDRESS NVARCHAR2(20) NOT NULL 
, MILERIGE NUMBER(10) 
, LIVE NVARCHAR2(2) NOT NULL 
, BIRTHYEAR NUMBER(4) NOT NULL 
, JOINDATE DATE 
, PHONENUMBER CHAR(8) 
, NAME NVARCHAR2(10) NOT NULL 
, RANK CHAR(1) 
, CONSTRAINT CUSTTBL3411_PK PRIMARY KEY 
  (
    CUSTCODE 
  )
  ENABLE 
);

-- proTbl3411 생성
CREATE TABLE PROTBL3411 
(
  PROCODE CHAR(6) NOT NULL 
, PROGROUP NCHAR(4) 
, AMOUNT NUMBER(3) NOT NULL 
, PRICE NUMBER(8) NOT NULL 
, PRONAME NCHAR(6) NOT NULL 
, CONSTRAINT PROTBL3411_PK PRIMARY KEY 
  (
    PROCODE 
  )
  ENABLE 
);

-- buyTbl3411 생성
CREATE TABLE BUYTBL3411 
(
  ID NUMBER(5) NOT NULL 
, SELLAMOUNT NUMBER(3) NOT NULL 
, CUSTCODE CHAR(5) NOT NULL 
, PROCODE CHAR(6) NOT NULL 
, PRICE NUMBER(8) NOT NULL 
, BUYDATE DATE NOT NULL 
, CONSTRAINT BUYTBL3411_PK PRIMARY KEY 
  (
    ID 
  )
  ENABLE 
);

-- FK 설정
ALTER TABLE BUYTBL3411
ADD CONSTRAINT BUYTBL3411_FK1 FOREIGN KEY
(
  CUSTCODE 
)
REFERENCES CUSTTBL3411
(
  CUSTCODE 
)
ENABLE;

ALTER TABLE BUYTBL3411
ADD CONSTRAINT BUYTBL3411_FK2 FOREIGN KEY
(
  PROCODE 
)
REFERENCES PROTBL3411
(
  PROCODE 
)
ENABLE;

-- 시퀀스 생성
DROP SEQUENCE BUY_SEQ;
CREATE SEQUENCE BUY_SEQ INCREMENT BY 1 START WITH 1;

CREATE TRIGGER BUYTBL3411_TRG 
BEFORE INSERT ON BUYTBL3411 
FOR EACH ROW 
BEGIN
  <<COLUMN_SEQUENCES>>
  BEGIN
    IF INSERTING AND :NEW.ID IS NULL THEN
      SELECT BUY_SEQ.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
    END IF;
  END COLUMN_SEQUENCES;
END;
/

-- custTbl3411 데이터 추가
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('PGW', N'송파구 올림픽로', '765', N'서울', '1983', TO_DATE('2007-05-03 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '88888888', N'박건우', 'F');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('LSW', N'남동구 구월동', '182', N'인천', '2003', TO_DATE('2011-07-25 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '55555555', N'이시우', 'H');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('KJH', N'서구 치평동', '474', N'광주', '1988', TO_DATE('2018-10-10 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '66666666', N'김지호', 'F');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('DHJ', N'연제구 연산동', '166', N'부산', '2000', TO_DATE('2011-06-23 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '44444444', N'도하준', 'H');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('PSRY', N'중구 동인동1가', '77', N'대구', '1971', TO_DATE('2013-02-25 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '33333333', N'박새로이', 'H');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('MYJ', N'수원시 팔달구', '172', N'경기', '1975', TO_DATE('2022-05-05 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '77777777', N'민예준', 'H');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, NAME, RANK) VALUES ('KEW', N'관악구 남부순환로', '286', N'서울', '1999', TO_DATE('2015-01-13 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), N'김은우', 'G');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, NAME, RANK) VALUES ('SYH', N'금정구 중앙대로', '370', N'부산', '1979', TO_DATE('2015-08-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), N'성이현', 'G');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('JDJ', N'서구 둔산동', '1173', N'대전', '1977', TO_DATE('2008-05-14 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '22222222', N'진도준', 'E');
INSERT INTO "TABLEDB3411"."CUSTTBL3411" (CUSTCODE, ADDRESS, MILERIGE, LIVE, BIRTHYEAR, JOINDATE, PHONENUMBER, NAME, RANK) VALUES ('CHM', N'관악구 관악로', '182', N'서울', '1987', TO_DATE('2005-02-02 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), '11111111', N'최혜민', 'H');

-- proTbl3411 데이터 추가
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('BJE02', N'의류', '75', '37000', N'청바지02');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, AMOUNT, PRICE, PRONAME) VALUES ('SNE01', '32', '35000', N'운동화01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('NOB01', N'전자', '5', '1000000', N'노트북01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('BJE01', N'의류', '37', '50000', N'청바지01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, AMOUNT, PRICE, PRONAME) VALUES ('FAN01', '21', '28000', N'선풍기01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('BOO02', N'서적', '46', '16000', N'도서02');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('CHM01', N'전자', '15', '200000', N'모니터01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, AMOUNT, PRICE, PRONAME) VALUES ('SNE02', '50', '57000', N'운동화02');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('BOO01', N'서적', '58', '25000', N'도서01');
INSERT INTO "TABLEDB3411"."PROTBL3411" (PROCODE, PROGROUP, AMOUNT, PRICE, PRONAME) VALUES ('MEM01', N'전자', '124', '80000', N'메모리01');

-- buyTbl 데이터 추가
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('1', 'DHJ', 'CHM01', '200000', TO_DATE('2023-04-22 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('1', 'PSRY', 'NOB01', '1000000', TO_DATE('2023-04-22 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('1', 'PGW', 'BJE01', '50000', TO_DATE('2023-04-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('10', 'SYH', 'MEM01', '80000', TO_DATE('2023-04-21 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('3', 'LSW', 'BJE02', '37000', TO_DATE('2023-04-21 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('2', 'MYJ', 'BOO01', '25000', TO_DATE('2023-04-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('2', 'JDJ', 'SNE01', '35000', TO_DATE('2023-04-23 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('5', 'KEW', 'CHM01', '200000', TO_DATE('2023-04-21 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('2', 'DHJ', 'SNE01', '35000', TO_DATE('2023-04-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('1', 'KEW', 'BOO02', '16000', TO_DATE('2023-04-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('2', 'LSW', 'SNE02', '57000', TO_DATE('2023-04-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('5', 'KJH', 'BOO02', '16000', TO_DATE('2023-04-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "TABLEDB3411"."BUYTBL3411" (SELLAMOUNT, CUSTCODE, PROCODE, PRICE, BUYDATE) VALUES ('3', 'SYH', 'FAN01', '28000', TO_DATE('2023-04-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

-- 1.
SELECT * FROM custtbl3411;

-- 2.
SELECT * FROM protbl3411;

-- 3.
SELECT * FROM buyTbl3411;

-- 4.
SELECT name || ' 고객님의 주소는 ' || address || '입니다.' "고객 주소" FROM custTbl3411;

-- 5.
SELECT * FROM proTbl3411 WHERE progroup = '의류' OR progroup = '서적';

-- 6.
INSERT INTO proTbl3411 (procode, proname, progroup, price, amount) VALUES ('CHM03', '티셔츠02', '의류', 25000, 11);
SELECT * FROM proTbl3411;

-- 7.
SELECT name, live, NVL(phonenumber, '정보없음') 전화번호 FROM custTbl3411 WHERE live = '서울' AND birthyear BETWEEN 1980 AND 1989;

-- 8.
SELECT procode, progroup, amount, price, price * 0.85 "할인가격", proname FROM proTbl3411;

-- 9.
SELECT custcode, address, milerige, live, birthyear, joindate, phonenumber, name, rank FROM custTbl3411 WHERE TO_NUMBER(TO_CHAR(SYSDATE, 'YYYY')) - TO_NUMBER(TO_CHAR(joindate, 'YYYY')) > 10;

-- 10.
SELECT * FROM custTbl3411 WHERE joindate < SYSDATE;

-- 11.
SELECT * FROM custTbl3411 ORDER BY rank, milerige DESC;

-- 12.
SELECT TO_CHAR(NEXT_DAY(ADD_MONTHS(SYSDATE, 100), 1), 'YYYY"년" MM"월" DD"일"') FROM dual;

-- 13.
--DELETE FROM custTbl3411 WHERE rank IS NOT NULL;
SELECT * FROM custTbl3411;

-- 14.
SELECT * FROM custTbl3411 WHERE phonenumber IS NOT NULL;

-- 15.
SELECT * FROM buyTbl3411 WHERE custcode = 'KEW' ORDER BY buydate DESC;

-- 16.
DELETE FROM buyTbl3411 WHERE custcode LIKE '_S%';
SELECT * FROM buyTbl3411;

-- 17.
SELECT proname 제품이름, price 단가, amount 재고수량 FROM proTbl3411 ORDER BY 제품이름;

-- 18.
SELECT * FROM custTbl3411 WHERE address LIKE '%동%';

-- 19.
SELECT procode, NVL(progroup, '그룹미정') 분류, amount, price, proname FROM proTbl3411;

-- 20.
SELECT name 고객이름, joindate 가입일 FROM custTbl3411 WHERE TO_CHAR(joindate, 'YYYY') = '2011';